<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forex Profit Journal</title>
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Kanit', sans-serif; }
    .hidden { display: none; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col">
  <header class="bg-black text-yellow-400 p-4 text-center font-bold text-xl shadow-lg">Forex Profit Journal</header>
  
  <main class="flex-1 p-4">
    <form id="tradeForm" class="grid grid-cols-2 gap-2 mb-4">
      <input class="p-2 rounded text-black" placeholder="คู่เงิน" id="pair">
      <input class="p-2 rounded text-black" placeholder="ขนาดล็อต" type="number" id="lot">
      <input class="p-2 rounded text-black" placeholder="กำไร/ขาดทุน ($)" type="number" id="profit">
      <input class="p-2 rounded text-black" placeholder="Risk ($)" type="number" id="risk">
      <input class="p-2 rounded text-black" placeholder="Reward ($)" type="number" id="reward">
      <button class="col-span-2 bg-yellow-500 text-black font-bold py-2 rounded">บันทึก</button>
    </form>

    <div class="overflow-x-auto">
      <table class="w-full text-center border border-yellow-500">
        <thead class="bg-yellow-500 text-black">
          <tr>
            <th class="p-2">คู่เงิน</th>
            <th class="p-2">ล็อต</th>
            <th class="p-2">กำไร/ขาดทุน</th>
            <th class="p-2">Risk</th>
            <th class="p-2">Reward</th>
            <th class="p-2">R:R</th>
            <th class="p-2">จัดการ</th>
          </tr>
        </thead>
        <tbody id="tradeTable"></tbody>
      </table>
    </div>

    <div id="summary" class="mt-4 p-4 bg-black rounded shadow-lg border border-yellow-500">
      <p id="totalProfit"></p>
      <p id="winRate"></p>
      <p id="expectancy"></p>
    </div>
  </main>

  <footer class="bg-black text-yellow-400 p-2 text-center">© 2025 Forex Journal</footer>

  <script>
    const form = document.getElementById('tradeForm');
    const table = document.getElementById('tradeTable');
    let trades = JSON.parse(localStorage.getItem('trades')) || [];

    function render() {
      table.innerHTML = '';
      let total = 0, wins = 0;
      trades.forEach((t, i) => {
        total += t.profit;
        if (t.profit > 0) wins++;
        let rr = t.risk > 0 ? (t.reward / t.risk).toFixed(2) : '-';
        table.innerHTML += `
          <tr class="border-b border-yellow-500">
            <td class="p-2">${t.pair}</td>
            <td class="p-2">${t.lot}</td>
            <td class="p-2 ${t.profit>=0?'text-green-400':'text-red-400'}">${t.profit}</td>
            <td class="p-2">${t.risk}</td>
            <td class="p-2">${t.reward}</td>
            <td class="p-2">${rr}</td>
            <td class="p-2">
              <button onclick="del(${i})" class="bg-red-500 px-2 rounded">ลบ</button>
            </td>
          </tr>`;
      });
      const winRate = trades.length ? (wins / trades.length * 100).toFixed(2) : 0;
      const avgWin = trades.filter(t=>t.profit>0).reduce((a,b)=>a+b.profit,0)/(wins||1);
      const avgLoss = trades.filter(t=>t.profit<0).reduce((a,b)=>a+b.profit,0)/(trades.length-wins||1);
      const expectancy = (winRate/100 * avgWin + (1-winRate/100) * avgLoss).toFixed(2);
      document.getElementById('totalProfit').innerText = 'กำไรรวม: $' + total;
      document.getElementById('winRate').innerText = 'Win Rate: ' + winRate + '%';
      document.getElementById('expectancy').innerText = 'Expectancy: $' + expectancy;
      localStorage.setItem('trades', JSON.stringify(trades));
    }

    form.onsubmit = e => {
      e.preventDefault();
      const trade = {
        pair: document.getElementById('pair').value,
        lot: +document.getElementById('lot').value,
        profit: +document.getElementById('profit').value,
        risk: +document.getElementById('risk').value,
        reward: +document.getElementById('reward').value,
      };
      trades.push(trade);
      render();
      form.reset();
    };

    function del(i){ trades.splice(i,1); render(); }
    render();
  </script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
